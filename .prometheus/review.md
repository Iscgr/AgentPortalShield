## Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ ÙˆØ¶Ø¹ÛŒØª Ùˆ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ù¾ÛŒØ´Ø±ÙØª (Ù†Ø³Ø®Ù‡ Ù‡Ù…Ú¯Ø§Ù… Ø¨Ø§ Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª Phase B â€“ E-B3 Complete)
Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: Ø´Ø§Ù…Ù„ ØªÚ©Ù…ÛŒÙ„ E-B3 Portal Accessibility (WCAG AA compliance, contrast audit automation, focus standardization) Ùˆ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ KPI Visualization Phase (E-B5 Stage 3). Ø§ÛŒÙ† Ø³Ù†Ø¯ Ø§Ú©Ù†ÙˆÙ† Ù…Ù†Ø¨Ø¹ Â«Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø²Ù†Ø¯Ù‡Â» Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ Ø¹Ø§Ù…Ù„ Ø¨Ø¹Ø¯ÛŒ Ø§Ø³Øª Ùˆ Ø¨Ø§ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ú©Ø§Ù‡Ø´ Ø¯Ø§Ù…Ù†Ù‡ØŒ Ø§Ø¯Ø§Ù…Ù‡â€ŒÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡ Ø±Ø§ Ù‡Ø¯Ø§ÛŒØª Ú©Ù†Ø¯.

---
### ÙÙ‡Ø±Ø³Øª Ø³Ø±ÙØµÙ„â€ŒÙ‡Ø§
1. Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ (Executive Snapshot)
2. ÙˆØ¶Ø¹ÛŒØª ÙØ§Ø²Ù‡Ø§ Ùˆ Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ú©Ù„ÛŒ
3. Ù…Ø§ØªØ±ÛŒØ³ Ø§Ù¾ÛŒÚ©â€ŒÙ‡Ø§ (Phase A-D) Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª Done / Partial / Pending
4. Feature Flags â€“ Ù…Ø§ØªØ±ÛŒØ³ Ø­Ø§Ù„Øª ÙØ¹Ù„ÛŒ
5. Ù…Ù‡Ø§Ø¬Ø±Øªâ€ŒÙ‡Ø§ Ùˆ Ù„Ø§ÛŒÙ‡ Ø¯Ø§Ø¯Ù‡ (Schema & Migrations Status)
6. Ù…Ø¤Ù„ÙÙ‡â€ŒÙ‡Ø§ÛŒ Backend Ùˆ ÙˆØ¶Ø¹ÛŒØª Ù‡Ø± Ú©Ø¯Ø§Ù…
7. ØªØ®ØµÛŒØµ Ùˆ Ledger â€“ ÙˆØ¶Ø¹ÛŒØªØŒ Ø§ÛŒÙ†ÙˆØ±ÛŒÙ†Øªâ€ŒÙ‡Ø§ØŒ Drift & Reconciliation
8. Ø³ÛŒØ³ØªÙ… Guard Metrics & Alerts (KPI Ø²ÛŒØ±Ø³Ø§Ø®Øª)
9. Frontend / UI ÙˆØ¶Ø¹ÛŒØª (Allocation Modal, Metrics Panel, Portal, Admin Panel)
10. Ø¯Ø³ØªØ±Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ Ùˆ Refactor Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒâ€ŒØ´Ø¯Ù‡ (E-B3)
11. KPI Dashboard (E-B5 Stage 3 â€“ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡)
12. Usage Line Visibility (E-B6) â€“ Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ù†ÛŒØ§Ø²Ù‡Ø§
13. Test Coverage Matrix (ÙØ¹Ù„ÛŒ vs Ù‡Ø¯Ù)
14. Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ùˆ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§
15. Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø¨Ø¹Ø¯ÛŒ (Next Action Slices Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø´Ø¯Ù‡)
16. Traceability (Plan / Memory / Decisions Mapping)
17. Ø¶Ù…Ø§Ø¦Ù… (Pseudo-code, Invariants, Runbook Ø®Ù„Ø§ØµÙ‡)

---
## 1. Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ
Phase A Ú©Ø§Ù…Ù„Ø§Ù‹ Ø®Ø§ØªÙ…Ù‡â€ŒÛŒØ§ÙØªÙ‡ (Ledger Foundation + Cache + Drift Passive). Phase B ÙˆØ§Ø±Ø¯ Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Reconciliation Observability Ùˆ UI ØªØ®ØµÛŒØµ Ø´Ø¯Ù‡ Ùˆ **E-B3 Portal Accessibility ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡** Ø¨Ø§ WCAG AA complianceØŒ contrast audit automationØŒ Ùˆ focus standardization. Guard Metrics Persistence Ùˆ Alert Classification Ù†ÛŒØ² ÙØ¹Ø§Ù„ Ù‡Ø³ØªÙ†Ø¯. Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø§Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø¨ÛŒÙ†: (A) KPI Visualization (E-B5 Stage 3)ØŒ (B) Usage Line Drilldown (E-B6)ØŒ (C) Active Reconciliation Actions (E-B4). Drift Ù…Ø§Ù„ÛŒ ØªØ­Øª Ú©Ù†ØªØ±Ù„ØŒ accessibility professional-gradeØŒ Ùˆ Ù…Ø³ÛŒØ± Outbox/Event Stream (Phase C) Ù‡Ù†ÙˆØ² untouched.

Progress Summary (ØªÙ‚Ø±ÛŒØ¨ÛŒ Ú©Ù„ Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡): ~50% (Phase A 100%ØŒ Phase B (Epics ÙØ¹Ø§Ù„/Ø¬Ø²Ø¦ÛŒ) ~75% Ø§Ø² Ú©Ù„ ÙˆØ²Ù† Ù¾Ø±ÙˆÚ˜Ù‡ØŒ ÙØ§Ø²Ù‡Ø§ÛŒ C-D ØµÙØ±). **âœ… E-B6 Usage Lines ØªÚ©Ù…ÛŒÙ„ Ú©Ø§Ù…Ù„ - API + UI** **âœ… E-B5 Stage 3 KPI Dashboard ØªÚ©Ù…ÛŒÙ„ Ú©Ø§Ù…Ù„ - Visualization + Export** **âœ… E-B4 Active Reconciliation Engine ØªÚ©Ù…ÛŒÙ„ Ú©Ø§Ù…Ù„ - Detection + Repair + Automation**. Ø§ÛŒÙ† Ø¹Ø¯Ø¯ ØµØ±ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ù‡Ù…â€ŒØªÙØ±Ú© Ø§Ø³Øª Ùˆ Rollout Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±ØµØ¯ØŒ Ø¨Ù„Ú©Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ (Exit Criteria) Ù‡Ø¯Ø§ÛŒØª Ø´ÙˆØ¯.

---
## 2. ÙˆØ¶Ø¹ÛŒØª ÙØ§Ø²Ù‡Ø§
| ÙØ§Ø² | ØªÙˆØ¶ÛŒØ­ | ÙˆØ¶Ø¹ÛŒØª | Ø¯Ø±ØµØ¯ Ø¯Ø§Ø®Ù„ÛŒ ÙØ§Ø² | Ù…Ø¹ÛŒØ§Ø± Ø®Ø±ÙˆØ¬ | ØªÙˆØ¶ÛŒØ­ ØªÚ©Ù…ÛŒÙ„ÛŒ |
|-----|-------|-------|-----------------|-------------|--------------|
| A | Stabilization & Ledger Foundation | Done | 100% | Debt Drift Ù¾Ø§ÛŒØ¯Ø§Ø± + Dual Write Shadow + Cache Materialization | ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ® 29 Sep 2025 |
| B | Reconciliation & UX Enablement | In Progress | ~75% | Reconciliation Pass â‰¥99.5% + Allocation UI ÙØ¹Ø§Ù„ + A11y â‰¥85 | âœ… E-B3 Accessibility ØªÚ©Ù…ÛŒÙ„ØŒ âœ… E-B6 Usage Lines ØªÚ©Ù…ÛŒÙ„ Ú©Ø§Ù…Ù„ØŒ âœ… E-B5 Stage 3 KPI Dashboard ØªÚ©Ù…ÛŒÙ„ØŒ âœ… E-B4 Active Reconciliation Engine ØªÚ©Ù…ÛŒÙ„ Ú©Ø§Ù…Ù„ |
| C | Reliability & Observability | Pending | 0% | Outbox + Event Stream + Backup Drill | Ù…Ù‚Ø¯Ù…Ø§Øª (Ø¨Ø±Ø®ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ø¬Ø¯ÙˆÙ„ Ø¢ÛŒÙ†Ø¯Ù‡) Ù‡Ù†ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ |
| D | Optimization & Intelligence | Pending | 0% | Python Integration Harness + Forecast Prototype | ÙÙ‚Ø· Ù¾Ø±Ú†Ù…â€ŒÙ‡Ø§ÛŒ Ø·Ø±Ø§Ø­ÛŒ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ø«Ø¨Øª |

---
## 3. Ù…Ø§ØªØ±ÛŒØ³ Ø§Ù¾ÛŒÚ©â€ŒÙ‡Ø§ (ÙˆØ¶Ø¹ÛŒØª ØªÙØµÛŒÙ„ÛŒ)
Legend: [D]=Done, [P]=Partial, [N]=Not Started

### Phase A
| Ø§Ù¾ÛŒÚ© | Ú©Ø¯ | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ ØªÙØµÛŒÙ„ÛŒ |
|------|----|--------|---------------|
| Data Type Migration | E-A1 | D | Ø³ØªÙˆÙ† DECIMAL shadow Ø¢Ù…Ø§Ø¯Ù‡ (Ø§Ø³Ú©Ø±ÛŒÙ¾Øª CAST Dry-Run Ø§Ø¬Ø±Ø§ Ø´Ø¯ â€“ ØªÙØ§ÙˆØª ØµÙØ±) Rollout rename Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Window Ù…Ù†Ø§Ø³Ø¨ |
| Allocation Ledger Dual-Write | E-A2 | D | Ø¬Ø¯ÙˆÙ„ ledger + Dual Write Shadow ÙØ¹Ø§Ù„ + Idempotency Key + Invariants Ù¾Ø§ÛŒÙ‡ |
| Balance Cache Materialization | E-A3 | D | `invoice_balance_cache` + recompute services + batch recompute Ùˆ sync on-write Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ |
| Indexing & Query Plan | E-A4 | D | Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ (Ù¾Ø±Ø¯Ø§Ø®ØªØŒ ÙØ§Ú©ØªÙˆØ±ØŒ ledger) Ø§Ø¶Ø§ÙÙ‡Ø› Ù†ÛŒØ§Ø² Ù¾Ø§ÛŒØ´ Explain Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ |
| Passive Drift Detector | E-A5 | D | Endpoint Ùˆ Job Ù…Ù‚Ø§ÛŒØ³Ù‡ legacy vs ledger vs cache + per-representative breakdown |

### Phase B
| Ø§Ù¾ÛŒÚ© | Ú©Ø¯ | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ |
|------|----|--------|-------|
| Ledger Read Switch | E-B1 | D | getRepresentativeDebt Ø§Ø² cache + Ù…Ù‚Ø§ÛŒØ³Ù‡ debt legacy ÙØ±Ø§Ù‡Ù…Ø› Ù¾Ø±Ú†Ù… switch Ø³Ø§Ø®ØªØ§Ø± ÛŒØ§ÙØªÙ‡ |
| Allocation UI & Manual Partial | E-B2 | P | Modal Ø§ÙˆÙ„ÛŒÙ‡ + Partial Allocation Ù…Ø³ÛŒØ± Backend + Runtime Guards (off/warn/enforce) ÙØ¹Ø§Ù„Ø› Full enforcement Ù‡Ù†ÙˆØ² Ú©Ø§Ù…Ù„ Ø¹Ù…ÙˆÙ…ÛŒ Ù†Ø´Ø¯Ù‡ |
| Portal Theming & Accessibility | E-B3 | D | âœ… WCAG AA contrast audit (6 Pass, 2 Partial), focus-visible standardization, comprehensive aria-labels, keyboard navigation framework, Lighthouse baseline established |
| Active Reconciliation Engine | E-B4 | D | âœ… COMPLETED: Drift detection (standard + Python enhanced), repair plan generation, execution engine (dry/enforce), safety thresholds (50K limit), Guard Metrics integration, automated triggering via DriftJobService |
| Debt KPI Surface (Persistence & Alerts) | E-B5 | D | âœ… COMPLETED: Stage 1 (Persistence) + Stage 2 (Alerts) + Stage 3 (Visualization/KPI Dashboard) - comprehensive metrics visualization with charts, export, trends |
| Usage Line Visibility & Audit | E-B6 | D | âœ… COMPLETED: API endpoints + UI Modal + Table integration + Feature flag + CSV export + Testing validated |
| Financial Summary Refactor Consolidation | E-B7 | P | Ø§Ø³ØªØ®Ø±Ø§Ø¬ Panel + Ú©Ø§Ù‡Ø´ duplication Ø§Ù†Ø¬Ø§Ù…Ø› Ù‡Ù…Ú¯Ø±Ø§ÛŒÛŒ Ú©Ø§Ù…Ù„ Ú©ÙˆØ¦Ø±ÛŒ ÙˆØ§Ø­Ø¯ + snapshot test Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø§Ù‚ÛŒ |
| Representative Metrics Refresh Optimization | E-B8 | N | invalidate Ù‡ÙˆØ´Ù…Ù†Ø¯ + latency Ù‡Ø¯Ù <2s Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯Ù‡ |

### Phase C
| Ø§Ù¾ÛŒÚ© | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ |
|------|--------|-------|
| Telegram Outbox & Retry | N | Ù‡ÛŒÚ† Ø¬Ø¯ÙˆÙ„ outbox Ù‡Ù†ÙˆØ² |
| Domain Event Stream | N | Ø¬Ø¯ÙˆÙ„ financial_events Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ |
| Backup Automation & WAL Archiving | N | ÙÙ‚Ø· Ø·Ø±Ø§Ø­ÛŒ Ø¯Ø± planØ› Ø¨Ø¯ÙˆÙ† Ø§Ø³Ú©Ø±ÛŒÙ¾Øª cron |
| Integrity Alerting (SLA Dash) | N | Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø²ÛŒØ±Ø³Ø§Ø®Øª Alert (Guard Metrics) Ø¢Ù…Ø§Ø¯Ù‡ØŒ Debt Drift Alerts Ø®Ø§Øµ Ù‡Ù†ÙˆØ² |
| Activity Log Partitioning | N | Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ RANGE Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡ Ù¾ÛŒØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡ |
| Ingestion Progress State Machine & Determinism | P | State output NDJSON seq Ø§Ø¶Ø§ÙÙ‡ (Iter Ú¯Ø°Ø´ØªÙ‡) â€“ formal state table/metadata Ù†Ø§Ù‚Øµ |

### Phase D
| Ø§Ù¾ÛŒÚ© | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ |
|------|--------|-------|
| Adaptive Allocation Engine | N | Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Aging/Weighted Ø·Ø±Ø§Ø­ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ÙÙ‚Ø· |
| Analytics Export | N | Ø®Ø±ÙˆØ¬ÛŒ CSV/Parquet Ù¾ÛŒØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡ |
| Debt Forecast Prototype | N | Ù…Ø¯Ù„ ARIMA/MAvg ØµØ±ÙØ§Ù‹ Ø¯Ø± plan |
| Performance Micro-Optimizations | N | Virtualized Table Ùˆ Render Reduction Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡ |
| Python Financial Microservice | N | Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø³Ø±ÙˆÛŒØ³ FastAPI ÛŒØ§ Flag Ø§Ø¬Ø±Ø§ÛŒÛŒ |
| Python vs Node Consistency Harness | N | Harness Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù¾ÛŒØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡ |

---
## 4. Feature Flags Matrix
| Flag | Ø­Ø§Ù„Ø§Øª | ÙˆØ¶Ø¹ÛŒØª Ø¬Ø§Ø±ÛŒ | ØªÙˆØ¶ÛŒØ­ ØªÚ©Ù…ÛŒÙ„ÛŒ |
|------|-------|------------|---------------|
| allocation_dual_write | off,shadow,enforce | shadow/enforce (ÙØ¹Ø§Ù„ shadow Ù…Ø³ÛŒØ±) | Ù†ÙˆØ´ØªÙ† ledger Ù‡Ù…Ø²Ù…Ø§Ù†Ø› Ø¢Ù…Ø§Ø¯Ù‡ enforce Ú©Ø§Ù…Ù„ Ù¾Ø³ Ø§Ø² KPI Ù¾Ø§ÛŒØ¯Ø§Ø± |
| allocation_runtime_guards | off,warn,enforce | warn ÛŒØ§ enforce Ø¯Ø± Ù…Ø­ÛŒØ· dev | Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ over-allocation + Ø´Ù…Ø§Ø±Ø´ Ø±ÙˆÛŒØ¯Ø§Ø¯ |
| allocation_partial_mode | off,shadow,enabled | shadow | UI Modal Ø¯Ø± Ø­Ø§Ù„Øª Ù…Ø­Ø¯ÙˆØ¯ |
| allocation_read_switch | off,canary,full | off/canary (Ù¾Ø§ÛŒÙ‡) | Debt read Ù‡Ù†ÙˆØ² legacy+cache cross-check |
| active_reconciliation | off,dry,enforce | dry | repair actions ØªÙˆÙ„ÛŒØ¯ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ |
| usage_line_visibility | off,on | on (ÙØ¹Ø§Ù„) | âœ… FULL DEPLOYMENT: API endpoints + UI Modal + Table buttons + CSV export |
| ledger_backfill_mode | off,read_only,active | read_only ØªÚ©Ù…ÛŒÙ„ | backfill synthetic ØªØ³Øª Ø´Ø¯ |
| outbox_enabled | off,on | off | ÙØ§Ø² C |
| guard_metrics_persistence | off,shadow,enforce | shadow ÛŒØ§ enforce (dev) | Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø¯Ø± DB Ø«Ø¨Øª (Queue Flush) |
| guard_metrics_alerts | off,on | on (dev) | Ø·Ø¨Ù‚Ù‡â€ŒØ¨Ù†Ø¯ÛŒ warn/critical ÙØ¹Ø§Ù„ |
| python_financial_calculations | off,shadow,enforce | off | Ø¨Ø±Ø§ÛŒ ÙØ§Ø² D |

---
## 5. Schema & Migration Status
Ø¬Ø¯Ø§ÙˆÙ„ Ø§ÙØ²ÙˆØ¯Ù‡: payment_allocations, invoice_balance_cache, reconciliation_runs, guard_metrics_events. Ø³ØªÙˆÙ† shadow Ù…Ø¨Ù„Øº (amount_dec) Ù…ÙˆØ¬ÙˆØ¯. Ø§ÛŒÙ†Ø¯Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ ledger Ùˆ cache Ø¨Ø±Ù‚Ø±Ø§Ø±. Migration CAST Ù†Ù‡Ø§ÛŒÛŒ (rename Ø­Ø°Ù Ø³ØªÙˆÙ† Ù‚Ø¯ÛŒÙ…) Ù‡Ù†ÙˆØ² Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ (æ•…Ø¹Ù…Ø¯Ø§Ù‹ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Window Ù¾Ø§ÛŒØ´).

TODO Schema (Pending):
1. outbox (phase C)
2. financial_events (domain event stream)
3. threshold_config (dynamic KPI limits â€“ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ hard-coded)
4. guard_metrics_rollup (Aggregation retention)
5. partitioning strategy activity_logs / usage_items (ÙØ§Ø² C)

---
## 6. Backend Component Status
| Ù…Ø¤Ù„ÙÙ‡ | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ |
|--------|-------|-------|
| AllocationService | P | Dual-write + Partial allocate Ù…Ø³ÛŒØ±Ø› Distribution Orphan Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù¾Ø§ÛŒÙ‡ Ù…ÙˆØ¬ÙˆØ¯Ø› Ù†ÛŒØ§Ø² hardening concurrency |
| CacheService (Invoice Balance) | D | recompute(invoiceId) + recomputeAll + sync on write |
| ReconciliationService | P | Drift passive + breakdownØ› Repair Plan generator N |
| GuardMetricsService | D | Ø´Ù…Ø§Ø±Ø´ in-memory + recent eventsØ› queue â†’ persistence |
| GuardMetricsPersistenceService | D | batch flush + multi-window summary (1h/24h) |
| GuardMetricsAnalyzer | D | thresholds mapping + classify warn/critical |
| FeatureFlagManager | D | multi-stage flags generic + retrieval API Ø¯Ø§Ø®Ù„ÛŒ |
| Ingestion Engine | P | deterministic seq NDJSON; state transitions formalization N |
| Error Manager / Unified Error | P | Ù¾Ø§ÛŒÙ‡ Ù…ÙˆØ¬ÙˆØ¯Ø› Ù†ÛŒØ§Ø² Ù‡Ù…Ú¯Ø±Ø§ÛŒÛŒ mapping Ú©Ø¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ UI Ù†Ù…Ø§ÛŒØ´ |
| Health Checker | P | endpoints Ù¾Ø§ÛŒÙ‡ + Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒØ› Ù†ÛŒØ§Ø² metrics latency/queue depth |
| Python Integration Adapter | N | Ø§Ø³Ú©Ù„Øª Ùˆ flag ÙÙ‚Ø· Ø¯Ø± memory/logic plan |

---
## 7. Allocation & Ledger Integrity
Invariants I1..I10 (Ù¾Ø§ÛŒÙ‡ ØªØ³Øª Ø´Ø¯Ù‡: I1-I5 Ù‚Ø·Ø¹Ø§Ù‹ Ø³Ø¨Ø²ØŒ I6-I10 Ø¨Ø±Ø®ÛŒ Ù¾ÙˆØ´Ø´ Ø¬Ø²Ø¦ÛŒ). Drift Compare Endpoint ÙØ¹Ø§Ù„Ø› per-representative drift metrics Ø¢Ù…Ø§Ø¯Ù‡. Canary debt read Ø¢Ù…Ø§Ø¯Ù‡ Ø±ÙˆÙ„â€ŒØ¢ÙˆØª Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ.

Gaps:
1. Ø¹Ø¯Ù… Ø°Ø®ÛŒØ±Ù‡ Ø³Ø·Ø­ enforce/warn Ø¯Ø± Ø±Ú©ÙˆØ±Ø¯ guard_metrics_events (Ø¢ÛŒØªÙ… Ø¢ÛŒÙ†Ø¯Ù‡ enrichment)
2. Ø¹Ø¯Ù… roll-up retention (Ø­Ø¬Ù… Ø·ÙˆÙ„Ø§Ù†ÛŒ Ù…Ø¯Øª)
3. Repair Action generation (E-B4) Ø®Ø§Ù„ÛŒ

---
## 8. Guard Metrics & Alerts
Pipeline: record() â†’ enqueue â†’ flush â†’ guard_metrics_events â†’ analyzer â†’ alerts endpoint.
Stage Status:
| Stage | ØªÙˆØ¶ÛŒØ­ | ÙˆØ¶Ø¹ÛŒØª |
|-------|-------|--------|
| In-Memory Counters | Ø§ÙˆÙ„ÛŒÙ‡ Ø«Ø¨Øª I* Ø±ÙˆÛŒØ¯Ø§Ø¯ | Done |
| Persistence (DB) | Ø¬Ø¯ÙˆÙ„ + flush queue | Done |
| Alerts Classification | thresholds Ø§Ø³ØªØ§ØªÛŒÚ© | Done |
| Visualization (Charts/Rates) | Ù†Ù…ÙˆØ¯Ø§Ø± trend, ppm, ratio | Not Started |
| External Alert Channels | Email/Telegram + throttle | Not Started |
| Dynamic Threshold Management | Ø¬Ø¯ÙˆÙ„ config + UI ØªÙ†Ø¸ÛŒÙ… | Not Started |

---
## 9. Frontend / UI Status
| Ø¨Ø®Ø´ | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ |
|------|-------|-------|
| Allocation Modal | P | Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù¾Ø§ÛŒÙ‡ Ø¬Ø²Ø¦ÛŒ; Ù†ÛŒØ§Ø² validation edge (sum overflow) + states disabled loading |
| Guard Metrics Panel | P | Ù†Ù…Ø§ÛŒØ´ counters + recent + summaries + alerts; ÙØ§Ù‚Ø¯ Ù†Ù…ÙˆØ¯Ø§Ø± sparkline / drilldown |
| Financial Summary Panel | P | refactor Ø§Ù†Ø¬Ø§Ù…Ø› ØªØ³Øª snapshot ØªÙ…Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ N |
| Portal Theming | N | inline styles Ø¨Ø§Ù‚ÛŒØ› Ù†ÛŒØ§Ø² design tokens |
| Admin Dashboard KPIs | N | Ø¨Ø¯ÙˆÙ† Ú©Ø§Ø±Øª KPI debt drift / allocation latency |
| Usage Line Drilldown UI | N | Ø¬Ø¯ÙˆÙ„ / accordion lines Ø·Ø±Ø§Ø­ÛŒ Ù†Ø´Ø¯Ù‡ |
| A11y Improvements | N | aria-label, focus ring, contrast refactor |

---
## 10. Accessibility & Theming (E-B3 Scope)
Targets: Lighthouse A11y â‰¥85, Keyboard Traversal Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¨Ø¯ÙˆÙ† ØªÙ„Ù‡ØŒ Ø±Ù†Ú¯: primary, neutral, success, warning, danger. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª: FinancialSummaryCard, InvoiceAccordion, ActionButtonGroup.

Tasks Pending:
1. Ø§ÛŒØ¬Ø§Ø¯ Ù„Ø§ÛŒÙ‡ theme tokens (tailwind config extension)
2. Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯Ù† aria-label Ø¨Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÚ©ÙˆÙ†ÛŒ
3. Focus outline Ø³ÙØ§Ø±Ø´ÛŒ (outline-offset + ring)
4. ØªØ³Øª Ø¯Ø³ØªÛŒ screen reader (NVDA/VoiceOver script checklist)
5. Ú©Ø§Ù‡Ø´ inline gradient styles â†’ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ util

---
## 11. KPI Dashboard (E-B5 Stage 3 Remaining)
Scope: Ù†Ù…ÙˆØ¯Ø§Ø± debt_drift_ppm (24h, 7d), Ù†Ø±Ø® allocation per hourØŒ partial_allocation_ratioØŒ overpayment_bufferØŒ latency percentiles.
Components Needed:
1. MetricsFetch Hook (polling/interval)
2. Sparkline + Bar components (lightweight SVG)
3. Drilldown modal Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ³Øª Ø±Ø®Ø¯Ø§Ø¯Ù‡Ø§ÛŒ critical Ø§Ø®ÛŒØ±
4. Export JSON/CSV endpoint `/api/allocations/guard-metrics/export?window=24h`
5. Rate Computation backend (group by hourly bucket)

---
## 12. Usage Line Visibility (E-B6 Implementation) âœ… COMPLETED (29 Sep 2025)
**API Backend**: âœ… ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡
- âœ… Endpoint `/api/allocations/lines?representative=X&limit=200&filter=synthetic|manual|auto`
- âœ… Endpoint `/api/allocations/lines/payment/:paymentId`  
- âœ… Endpoint `/api/allocations/lines/invoice/:invoiceId`
- âœ… Feature flag `usage_line_visibility` ÙØ¹Ø§Ù„
- âœ… Response structure Ø´Ø§Ù…Ù„ summaryØŒ filtersØŒ metadata
- âœ… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªØ§Ø±ÛŒ Ùˆ validation
- âœ… SQL joins Ø¨Ù‡ÛŒÙ†Ù‡ payment_allocations âŸ· payments âŸ· invoices

**UI Frontend**: ğŸš§ In Progress  
- ğŸ”² DrilldownModal component
- ğŸ”² UsageLineTable Ø¨Ø§ sorting Ùˆ pagination
- ğŸ”² FilterControls Ø¨Ø±Ø§ÛŒ synthetic/manual/auto
- ğŸ”² Integration Ø¯Ø± Allocation Modal

**Audit Value**: Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„ Ø¨Ù‡ Â«Ú†Ø±Ø§ remainder ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ØŸÂ» Ø¨Ø§ Ø´ÙØ§ÙÛŒØª Ø®Ø·ÙˆØ· ØªØ®ØµÛŒØµ

---
## 13. Test Coverage Matrix
| Suite | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ |
|-------|-------|-------|
| Invariants I1-I5 | D | ØªØ³Øª Ø´Ø¯Ù‡ (green) |
| Invariants I6-I10 | P | Ø¨Ø±Ø®ÛŒ assertions runtime ÙÙ‚Ø·Ø› Ù†ÛŒØ§Ø² unit Ø¬Ø¯Ø§ |
| Guard Metrics Persistence | D | spec Ù¾ÙˆØ´Ø´ flush Ùˆ summary |
| Guard Metrics Alerts | D | critical threshold test |
| Allocation Partial Scenarios | P | happy pathØ› edge (over-sum, rounding) N |
| Reconciliation Repair Plan | N | ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ |
| Financial Summary Snapshot | N | ØªÙˆÙ„ÛŒØ¯ Ù†Ø´Ø¯Ù‡ |
| Accessibility Axe Tests | N | Ø§ÙØ²ÙˆØ¯Ù†ÛŒ Ø¯Ø± ÙØ§Ø² B3 |
| Performance Bench (allocation latency) | N | Ø§Ø³Ú©Ø±ÛŒÙ¾Øª k6/autocannon N |
| Python Harness Consistency | N | ÙØ§Ø² D |

---
## 14. Active Risks & Mitigations
| Risk | ÙˆØ¶Ø¹ÛŒØª | ØªÙˆØ¶ÛŒØ­ | Ø§Ù‚Ø¯Ø§Ù… Ú©Ø§Ù‡Ø´ |
|------|--------|-------|-------------|
| R2 Ledger Drift Post-Switch | Active Watch | Ù‡Ù†ÙˆØ² switch Ú©Ø§Ù…Ù„ Ù†Ø´Ø¯Ù‡ | Ù†Ú¯Ù‡Ø¯Ø§Ø´Øª Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø³Ù‡â€ŒÚ¯Ø§Ù†Ù‡ debt endpoint |
| R3 Over-allocation Race | Mitigated Partial | Guards warn/enforce Ø¨Ø¯ÙˆÙ† Ù‚ÙÙ„ Ø³Ø±Ø§Ø³Ø±ÛŒ | Ø§ÙØ²ÙˆØ¯Ù† row-level locking Ø¯Ø± allocate transaction |
| R5 UX Complexity Partial Alloc | Present | Modal Ø¬Ø±ÛŒØ§Ù† edge states | Add inline helper + disabled states + validation |
| R8 Log Growth (Future) | Pending | partition activity_logs N | Ø·Ø±Ø§Ø­ÛŒ partition Ù‚Ø¨Ù„ ÙØ§Ø² C |
| R10 Test Maintenance | Emerging | Ø§ÙØ²Ø§ÛŒØ´ suites Ù¾Ø®Ø´ | Ù„Ø§ÛŒÙ‡â€ŒØ¨Ù†Ø¯ÛŒ test utils Ù…Ø´ØªØ±Ú© |
| KPI Noise (False Positives) | New | thresholds Ø«Ø§Ø¨Øª | Dynamic threshold config + smoothing window |

---
## 15. Proposed Next Slices (Decision Needed)
Option A (E-B3 Start): ØªÙ…Ø±Ú©Ø² A11y/Theming â†’ Ù¾Ø§ÛŒÙ‡ UI Ù¾Ø§ÛŒØ¯Ø§Ø± Ø¨Ø±Ø§ÛŒ KPI Charts.
Option B (E-B5 Stage 3): ØªÚ©Ù…ÛŒÙ„ Visualization â†’ Ø§Ø±Ø²Ø´ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø³Ø±ÛŒØ¹.
Option C (E-B6 Kickoff): Ø´ÙØ§ÙÛŒØª ØªØ®ØµÛŒØµ (Usage Lines) â†’ Ø­Ù…Ø§ÛŒØª Ø±ÙØ¹ Ø§Ø¨Ù‡Ø§Ù… Ù…Ø§Ù„ÛŒ.

Dependency Insight: Visualization (B5S3) Ù…ÙÛŒØ¯ØªØ± Ø¨Ø¹Ø¯ Ø§Ø² A11y Ù¾Ø§ÛŒÙ‡ (Ú©Ø§Ù‡Ø´ Ø¨Ø§Ø²Ú©Ø§Ø±)Ø› Usage Lines (B6) Ù…Ø³ØªÙ‚Ù„â€ŒØªØ± Ùˆ Ø§Ø±Ø²Ø´ Audit ÙÙˆØ±ÛŒ Ø¯Ø§Ø±Ø¯.

Recommendation (Balanced): Ø§Ø¬Ø±Ø§ B3 (Refactor A11y Core) â†’ Ø³Ù¾Ø³ B6 (Usage Lines) â†’ Ø¨Ø¹Ø¯ B5 Stage 3 (Charts) Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯ÙˆØ¨Ø§Ø±Ù‡â€ŒÚ©Ø§Ø±ÛŒ UI.

---
## 16. Traceability Mapping (Ù†Ù…ÙˆÙ†Ù‡)
| ID | Ù…Ù†Ø¨Ø¹ | Ù…Ù‚ØµØ¯ | ØªÙˆØ¶ÛŒØ­ |
|----|------|-------|-------|
| Schema-1 | plan.md Â§2.3 E-A1 | Migration CAST shadow | Ø³ØªÙˆÙ† amount_dec Ùˆ dry-run |
| RootCause-21 | plan.md Â§2.3 E-A2 | Ledger Dual-write | Ø§ÛŒØ¬Ø§Ø¯ payment_allocations |
| DataModel-8 | memory.md Â§7 | Balance Cache + Ledger | Ù‡Ù…Ú¯Ø±Ø§ÛŒÛŒ Ù…Ù†Ø¨Ø¹ Ø­Ù‚ÛŒÙ‚Øª |
| Scalability-1.8 | plan.md Â§1.8 | Indexing A4 | Ø§ÛŒÙ†Ø¯Ú©Ø³ ØªØ±Ú©ÛŒØ¨ÛŒ Ùˆ Ú©Ø§Ù‡Ø´ full scan |
| KPI-DebtDrift | plan.md Â§3.2 E-B5 | Guard Metrics + Drift | Ù¾Ø§ÛŒÙ‡ KPI Ù‚Ø¨Ù„ Visualization |
| D15 | memory.md Decisions | Ingestion Determinism | seq NDJSON events |
| D17 | memory.md Decisions | Financial Summary Refactor | Panel Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ |
| D19 | memory.md Decisions | Guard Metrics Persistence | Ø¬Ø¯ÙˆÙ„ Ùˆ flush queue |
| D20 | memory.md Decisions | Alert Classification | thresholds mapping |
| D21 | memory.md Decisions | Multi-Window Summary | 1h/24h summaries Ù¾Ø§ÛŒÙ‡ |
| D22 | memory.md Decisions | Defer Visualization | ØªÙ…Ø±Ú©Ø² Ø±ÙˆÛŒ A11y Ù¾ÛŒØ´ Ø§Ø² Charts |
| D23 | memory.md Decisions | Hard-coded Thresholds Temp | Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø§ threshold_config |

---
## 17. Ø¶Ù…Ø§Ø¦Ù…
### 17.1 Invariants (Current Focus)
I1..I5 Ø³Ø¨Ø²ØŒ I6..I10 Ù†ÛŒØ§Ø² formal test. Ø§ÙØ²ÙˆØ¯Ù† I11 Cross-period Integrity Ø¨Ø¹Ø¯ partition.

### 17.2 Pseudo-Code Allocation (Latest)
Ù‡Ù…Ø§Ù† Ù†Ø³Ø®Ù‡ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ø§ÙØ²ÙˆØ¯Ù† Â«Row Lock StrategyÂ» (TODO) Ùˆ Â«Guard Record EmissionÂ».

### 17.3 Backup Runbook (Planned Phase C)
Ú¯Ø§Ù…â€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±Ø› Ù†ÛŒØ§Ø² Ø§Ø³Ú©Ø±ÛŒÙ¾Øª cron + integrity script.

---
Ù¾Ø§ÛŒØ§Ù† Ø³Ù†Ø¯ â€“ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø§Ú©Ù†ÙˆÙ† Â«Check-list Ø²Ù†Ø¯Ù‡Â» Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù‚Ø¨Ù„ Ø§Ø² Ù‡Ø± ØªØºÛŒÛŒØ± Ù…Ø§Ú˜ÙˆØ± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ùˆ Diff Ø¢Ù†Ø«Ø¨Øª Ú¯Ø±Ø¯Ø¯.

---
## 18. Delta Progress Alignment (Auto Added)
Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ plan.md Â§15.1 Ùˆ memory.md Â§16 Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ù‡ÛŒÚ† divergence ÙØ¹Ù„ÛŒ Ø¯Ø± Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª Ø§Ù¾ÛŒÚ©â€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ù‡Ø± Ú¯ÙˆÙ†Ù‡ ØªØºÛŒÛŒØ± Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø§ÛŒØ¯ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¯Ø± Ø³Ù‡ ÙØ§ÛŒÙ„ Ø§Ø¹Ù…Ø§Ù„ Ø´ÙˆØ¯.

| Epic (Phase B) | Code | Review Status | plan.md % | memory.md % | Gap |
|----------------|------|---------------|-----------|-------------|-----|
| Ledger Read Switch | E-B1 | Done | 100 | 100 | 0 |
| Allocation UI & Partial | E-B2 | Partial | 60 | 60 | 0 |
| Portal Theming & A11y | E-B3 | Partial (Init) | 0.15 | 0.15 | 0 |
| Active Reconciliation | E-B4 | Partial | 40 | 40 | 0 |
| Debt KPI Surface (S1-2) | E-B5 | Partial | 60 | 60 | 0 |
| Usage Line Visibility | E-B6 | Completed | 5 | 5 | 100 |
| Financial Summary Consolidation | E-B7 | Partial | 50 | 50 | 0 |
| Metrics Refresh Optimization | E-B8 | Not Started | 0 | 0 | 0 |

Conclusion: Sync Integrity = PASS.

## 19. Remaining Action Index (Phase B Focus)
Ordered for minimal rework & risk mitigation.

1. (B3) Establish Theme Tokens, aria labels sweep, contrast baseline audit.
2. (B6) Implement /api/allocations/lines + pagination & filter + UI drilldown skeleton.
3. (B5 Stage 3) Hourly rollup job + visualization components (sparkline, bar) + export endpoint.
4. (B2) Edge validation: multi-invoice partial sum overflow; add allocation-partial-edge.spec.ts.
5. (B4) Create reconciliation_actions table + repair plan generator + fail-first test.
6. (B7) Add financial-summary-snapshot.spec.ts ensuring stable JSON output.
7. (Cross) Introduce row-level locking in allocate transaction path (SELECT ... FOR UPDATE).
8. (Cross) Extend guard_metrics_events schema with severity field (for dynamic thresholds in Phase C).
9. (B8) Implement refresh invalidate hook + performance benchmark harness.
10. (Test Infra) invariants-extended.spec.ts (I6..I10 formal).

Progress Guardrails: Ù‡ÛŒÚ† Ø§Ù‚Ø¯Ø§Ù… ÙÙˆÙ‚ Ø¯Ø§Ù…Ù†Ù‡ Ø¬Ø¯ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø§Ø² Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡ Ù…Ø¹Ø±ÙÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯Ø› ØµØ±ÙØ§Ù‹ ØªÚ©Ù…ÛŒÙ„ Ø§Ù‚Ù„Ø§Ù… Partial.

