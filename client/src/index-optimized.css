@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== UNIFIED DESIGN SYSTEM - WCAG AA COMPLIANT ===== */
:root {
  /* Primary Color Palette - WCAG AA Enhanced */
  --ds-primary: hsl(258 62% 58%);
  --ds-primary-foreground: hsl(0 0% 100%);
  --ds-neutral: hsl(220 9% 46%);
  --ds-neutral-foreground: hsl(210 20% 98%);
  --ds-success: hsl(145 65% 35%);
  --ds-success-foreground: hsl(145 25% 96%);
  --ds-warning: hsl(40 90% 55%);
  --ds-warning-foreground: hsl(40 30% 10%);
  --ds-danger: hsl(350 55% 45%);
  --ds-danger-foreground: hsl(0 0% 100%);
  
  /* Focus Ring */
  --focus-ring-color: hsl(258 90% 70% / 0.9);
  --focus-ring-offset: 2px;
  --focus-ring-width: 3px;
  
  /* Radius */
  --radius: 0.75rem;
}

/* DARK THEME - Primary Theme */
:root,
.dark {
  --background: hsl(220 30% 8%);
  --foreground: hsl(280 15% 85%);
  --muted: hsl(270 20% 15%);
  --muted-foreground: hsl(270 10% 60%);
  --popover: hsl(265 25% 12%);
  --popover-foreground: hsl(280 15% 85%);
  --card: hsl(265 25% 10%);
  --card-foreground: hsl(280 15% 85%);
  --border: hsl(270 15% 45%);
  --input: hsl(270 20% 18%);
  --primary: var(--ds-primary);
  --primary-foreground: var(--ds-primary-foreground);
  --secondary: hsl(155 35% 35%);
  --secondary-foreground: hsl(155 45% 85%);
  --accent: hsl(195 45% 35%);
  --accent-foreground: hsl(195 55% 85%);
  --destructive: var(--ds-danger);
  --destructive-foreground: var(--ds-danger-foreground);
  --ring: hsl(258 30% 55%);
}

/* PUBLIC PORTAL ISOLATION */
.public-portal-isolated {
  --admin-sidebar-display: none !important;
  --admin-header-display: none !important;
  --admin-nav-display: none !important;
}

.public-portal-isolated .admin-panel-background,
.public-portal-isolated .sidebar,
.public-portal-isolated .main-content,
.public-portal-isolated .admin-header,
.public-portal-isolated [data-admin-only],
.public-portal-isolated [class*="admin"],
.public-portal-isolated [class*="sidebar"],
.public-portal-isolated [class*="nav"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

.public-portal-isolated .portal-header,
.public-portal-isolated .portal-content,
.public-portal-isolated [class*="portal"] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground font-sans antialiased;
    direction: rtl;
    font-family: 'Inter', 'Tahoma', 'Arial', sans-serif;
    min-height: 100vh;
    position: relative;
  }

  /* UNIFIED BACKGROUND SYSTEM */
  .admin-panel-background {
    background: linear-gradient(135deg, 
      var(--background) 0%, 
      hsl(235 25% 10%) 50%, 
      var(--background) 100%
    );
    min-height: 100vh;
    position: relative;
  }

  /* OPTIMIZED CARD SYSTEM */
  .unified-card {
    background: rgba(15, 23, 42, 0.6);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(148, 163, 184, 0.15);
    border-radius: var(--radius);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    color: var(--card-foreground);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .unified-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  /* STABLE DIALOG SYSTEM */
  .stable-dialog {
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(148, 163, 184, 0.2);
    border-radius: var(--radius);
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
    color: var(--foreground);
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    max-width: 32rem !important;
    max-height: calc(100vh - 2rem) !important;
    overflow-y: auto !important;
    z-index: 50 !important;
  }

  /* ENHANCED FORM ELEMENTS */
  .unified-input {
    background: rgba(30, 41, 59, 0.8);
    border: 1px solid var(--border);
    border-radius: calc(var(--radius) - 4px);
    color: var(--foreground);
    padding: 0.75rem 1rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .unified-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(148, 163, 184, 0.1);
    outline: none;
  }

  /* UNIFIED BUTTON SYSTEM */
  .unified-button-primary {
    background: var(--primary);
    color: var(--primary-foreground);
    border: none;
    border-radius: calc(var(--radius) - 4px);
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    transition: background-color 0.2s ease, transform 0.1s ease;
    cursor: pointer;
  }

  .unified-button-primary:hover {
    background: hsl(258 62% 50%);
    transform: translateY(-1px);
  }

  .unified-button-secondary {
    background: var(--secondary);
    color: var(--secondary-foreground);
    border: none;
    border-radius: calc(var(--radius) - 4px);
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    transition: background-color 0.2s ease;
    cursor: pointer;
  }

  /* NAVIGATION SYSTEM */
  .unified-nav-item {
    background: rgba(30, 41, 59, 0.6);
    border: 1px solid rgba(148, 163, 184, 0.1);
    border-radius: calc(var(--radius) - 4px);
    color: var(--foreground);
    padding: 0.75rem 1rem;
    transition: all 0.2s ease;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .unified-nav-item:hover {
    background: rgba(30, 41, 59, 0.8);
    border-color: rgba(148, 163, 184, 0.2);
    transform: translateX(-4px);
  }

  .unified-nav-item.active {
    background: var(--primary);
    border-color: var(--primary);
    color: var(--primary-foreground);
  }

  /* TABLE SYSTEM */
  .unified-table {
    background: rgba(30, 41, 59, 0.4);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    width: 100%;
  }

  .unified-table-row {
    border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    transition: background-color 0.2s ease;
  }

  .unified-table-row:hover {
    background: rgba(30, 41, 59, 0.6);
  }

  .unified-table-cell {
    padding: 0.75rem 1rem;
    color: var(--foreground);
  }
}

/* MOBILE OPTIMIZATIONS */
@media (max-width: 768px) {
  .main-content {
    padding: 1rem;
    padding-bottom: calc(4rem + env(safe-area-inset-bottom, 0px));
  }

  /* Touch-friendly elements */
  .unified-button-primary,
  .unified-button-secondary,
  .unified-nav-item {
    min-height: 44px;
    min-width: 44px;
    padding: 12px 16px;
    font-size: 16px;
  }

  .unified-input {
    min-height: 44px;
    font-size: 16px;
    padding: 12px 16px;
  }

  /* Simplified effects for mobile */
  .unified-card {
    backdrop-filter: blur(8px);
  }

  .stable-dialog {
    position: fixed !important;
    top: 1rem !important;
    left: 1rem !important;
    right: 1rem !important;
    transform: none !important;
    max-width: calc(100vw - 2rem) !important;
    width: calc(100vw - 2rem) !important;
    max-height: calc(100vh - 2rem) !important;
  }

  /* Grid responsive */
  .grid-responsive {
    grid-template-columns: 1fr !important;
    gap: 0.75rem !important;
  }

  /* Typography scaling */
  h1 { font-size: 1.5rem !important; }
  h2 { font-size: 1.25rem !important; }
  h3 { font-size: 1.125rem !important; }
}

/* ENHANCED DIALOG POSITIONING */
[data-radix-dialog-content] {
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -50%) !important;
  max-height: 90vh !important;
  overflow-y: auto !important;
  z-index: 1000 !important;
}

[data-radix-dialog-overlay] {
  position: fixed !important;
  inset: 0 !important;
  z-index: 999 !important;
  background-color: rgba(0, 0, 0, 0.5) !important;
  backdrop-filter: blur(4px) !important;
}

/* MOBILE DROPDOWN FIXES */
@media (max-width: 768px) {
  [data-radix-popper-content-wrapper] {
    position: fixed !important;
    z-index: 60 !important;
    left: 1rem !important;
    right: 1rem !important;
    max-width: calc(100vw - 2rem) !important;
  }

  [data-radix-select-content] {
    position: relative !important;
    width: 100% !important;
    max-width: 100% !important;
  }
}

/* ACCESSIBILITY UTILITIES */
@layer utilities {
  .focus-ring:focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: var(--focus-ring-offset);
    box-shadow: 0 0 0 2px var(--background), 0 0 0 4px var(--focus-ring-color);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0,0,0,0);
    white-space: nowrap;
    border: 0;
  }
}

/* COMPONENT UTILITIES */
@layer components {
  .sidebar-nav {
    @apply w-64 bg-background border-r border-border;
  }

  .main-content {
    @apply min-h-screen bg-background transition-all duration-300;
  }

  @media (min-width: 1024px) {
    .main-content {
      @apply mr-64;
    }
  }

  .stat-card {
    @apply unified-card p-4 lg:p-6 cursor-pointer;
  }

  /* Status badges */
  .status-unpaid {
    @apply px-2 py-1 bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 text-xs rounded-full;
  }

  .status-paid {
    @apply px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs rounded-full;
  }

  .status-overdue {
    @apply px-2 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-xs rounded-full;
  }

  .activity-item {
    @apply flex items-start space-x-3 space-x-reverse p-3 hover:bg-muted rounded-lg;
  }
}

/* CUSTOM SCROLLBAR */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--muted-foreground);
}

/* UPLOAD AREA */
.upload-area {
  @apply border-2 border-dashed border-border rounded-lg p-8 text-center transition-colors hover:border-primary hover:bg-primary/5;
}

.upload-area.dragover {
  @apply border-primary bg-primary/10;
}

/* ANIMATIONS */
@keyframes success-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.success-animation {
  animation: success-pulse 0.6s ease-in-out;
}

/* LOADING STATES */
.loading-shimmer {
  @apply animate-pulse bg-muted rounded;
}

/* PORTAL SPECIFIC */
.portal-dark {
  @apply bg-background text-foreground;
}

.portal-card {
  @apply unified-card p-4;
}

.portal-stat-value {
  @apply text-2xl font-bold;
}

.portal-debt {
  @apply text-red-400;
}

.portal-credit {
  @apply text-green-400;
}

.portal-warning {
  @apply text-yellow-400;
}